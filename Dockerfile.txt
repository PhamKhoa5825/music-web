# --- Giai đoạn 1: Build ứng dụng (Dùng Maven) ---
# Sử dụng Maven với JDK 17 để build
FROM maven:3.9.6-eclipse-temurin-17 AS build

# Tạo thư mục làm việc
WORKDIR /app

# Copy file pom.xml và source code vào
COPY pom.xml .
COPY src ./src

# Chạy lệnh build (bỏ qua test để tiết kiệm thời gian)
RUN mvn clean package -DskipTests

# --- Giai đoạn 2: Chạy ứng dụng (Dùng JRE nhẹ) ---
# Sử dụng JDK 17 bản rút gọn để chạy cho nhẹ
FROM eclipse-temurin:17-jdk-focal

WORKDIR /app

# Copy file .war (hoặc .jar) từ giai đoạn build sang đây và đổi tên thành app.war
# Lưu ý: Vì trong pom.xml bạn để <packaging>war</packaging> nên nó sẽ ra file .war
COPY --from=build /app/target/*.war app.war

# Mở port 8080 (Mặc định của Spring Boot)
EXPOSE 8080

# Lệnh chạy ứng dụng
ENTRYPOINT ["java", "-jar", "app.war"]