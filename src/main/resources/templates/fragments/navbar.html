<!DOCTYPE html>
<html lang="vi">
<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background: linear-gradient(90deg, #092c16 0%, #000000 100%); z-index: 1050;">
    <div class="container-fluid">
        <!-- Logo và Brand -->
        <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="/home.html">
            <i class="bi bi-music-note-beamed text-info fs-4"></i>
            <span>MusicPro</span>
        </a>

        <!-- Navbar Toggler -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar Links -->
        <div class="collapse navbar-collapse" id="mainNavbar">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/home.html"><i class="bi bi-house-door me-1"></i> Trang chủ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/for-you.html"><i class="bi bi-heart me-1"></i> Dành cho bạn</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/ranking.html"><i class="bi bi-trophy me-1"></i> Xếp hạng</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/playlists.html"><i class="bi bi-music-note-list me-1"></i> Playlist</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/history.html"><i class="bi bi-clock-history me-1"></i> Lịch sử</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/ai-dj.html"><i class="bi bi-robot me-1"></i> AI DJ</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle me-1"></i> Tài khoản
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="#" onclick="changeUser()"><i class="bi bi-arrow-left-right me-2"></i> Đổi User</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-box-arrow-right me-2"></i> Đăng xuất</a></li>
                    </ul>
                </li>
            </ul>

            <!-- Search Bar -->
            <div class="position-relative me-3">
                <input type="text" class="form-control form-control-sm bg-black text-white border-secondary rounded-pill ps-4"
                       style="width: 250px;" placeholder="Tìm kiếm bài hát, playlist..."
                       id="global-search-input">
                <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-2 text-secondary"></i>
                <div id="global-search-results" class="position-absolute top-100 start-0 end-0 mt-1 bg-dark border border-secondary rounded shadow-lg d-none"
                     style="max-height: 400px; overflow-y: auto; z-index: 2000;"></div>
            </div>

            <!-- User Avatar -->
            <div class="navbar-text">
                <img src="https://placehold.co/35" class="rounded-circle border border-info"
                     alt="Avatar" data-bs-toggle="tooltip" data-bs-title="User ID: 1">
            </div>
        </div>
    </div>
</nav>

<!-- Global Search Script -->
<script>
    const API = '/api';
    const USER_ID = localStorage.getItem('music_user_id') || 1;
    let searchTimeout = null;

    // Global Search Function
    async function globalSearch(keyword) {
        const resultsDiv = document.getElementById('global-search-results');
        if (!keyword.trim()) {
            resultsDiv.classList.add('d-none');
            return;
        }

        try {
            const res = await fetch(`${API}/search?keyword=${encodeURIComponent(keyword)}`);
            const data = await res.json();

            let html = '<div class="p-2">';

            // Songs
            if (data.songs && data.songs.length > 0) {
                html += '<h6 class="text-info small mb-2">BÀI HÁT</h6>';
                data.songs.forEach(song => {
                    html += `
                    <div class="d-flex align-items-center p-2 hover-bg-secondary rounded cursor-pointer mb-1"
                         onclick="navigateToSong(${song.songId})">
                        <img src="${song.coverImage || 'https://placehold.co/40'}"
                             class="rounded me-3" width="40" height="40">
                        <div>
                            <div class="text-white fw-bold small">${song.title}</div>
                            <div class="text-white-50 small">${song.artist?.name || 'Unknown'}</div>
                        </div>
                    </div>`;
                });
            }

            // Playlists
            if (data.playlists && data.playlists.length > 0) {
                html += '<h6 class="text-info small mt-3 mb-2">PLAYLIST</h6>';
                data.playlists.forEach(playlist => {
                    html += `
                    <div class="d-flex align-items-center p-2 hover-bg-secondary rounded cursor-pointer mb-1"
                         onclick="window.location.href='/playlist-detail.html?id=${playlist.playlistId}'">
                        <img src="${playlist.imageUrl || 'https://placehold.co/40'}"
                             class="rounded me-3" width="40" height="40">
                        <div class="text-white fw-bold small">${playlist.name}</div>
                    </div>`;
                });
            }

            if (html === '<div class="p-2">') {
                html = '<div class="p-3 text-center text-muted">Không tìm thấy kết quả</div>';
            }

            html += '</div>';
            resultsDiv.innerHTML = html;
            resultsDiv.classList.remove('d-none');

        } catch (error) {
            console.error('Search error:', error);
        }
    }

    // Search input event
    document.getElementById('global-search-input')?.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => globalSearch(e.target.value), 300);
    });

    // Hide results when clicking outside
    document.addEventListener('click', function(e) {
        const searchInput = document.getElementById('global-search-input');
        const searchResults = document.getElementById('global-search-results');
        if (searchResults && !searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.classList.add('d-none');
        }
    });

    // Helper function to navigate to song detail
    function navigateToSong(songId) {
        window.location.href = `/song-detail.html?id=${songId}`;
    }

    // Change user function
    function changeUser() {
        const newUserId = prompt('Nhập User ID mới:', USER_ID);
        if (newUserId && newUserId !== USER_ID) {
            localStorage.setItem('music_user_id', newUserId);
            window.location.reload();
        }
    }
</script>
</html>